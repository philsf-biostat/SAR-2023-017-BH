---
title: "Sensitivity of mortality rates to the imputation of missing socioeconomic data: cohort study"
subtitle: 'DOCUMENT: SAR-2023-017-BH-v01'
author: '**From:** Felipe Figueiredo **To:** Brennan Hickson'
date: "2023-12-18"
output:
  html_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 6
    keep_md: yes
    number_sections: yes
    toc: yes
  pdf_document:
    number_sections: yes
    toc: yes
  word_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 6
    reference_docx: misc/style_SAR_en.docx
    toc: yes
# toc-title: "Sum√°rio"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = normalizePath(".."))
options(scipen = 999)
library(pander)
library(knitr)
panderOptions('table.style', 'rmarkdown')
panderOptions('table.split.table', 160)
```

---

\newpage

**Sensitivity of mortality rates to the imputation of missing socioeconomic data: cohort study**

**Document version**

```{r history}
Version <- c("01")
Changes <- c("Initial version")
history <- cbind(Version, Changes)
colnames(history) <- c("Version", "Alterations")
# pander(history, split.cells = 70)
kable(history)
```

```{r results, include=FALSE}
source("scripts/results.R", encoding = 'UTF-8')
```

---

# Abbreviations

# Context

## Objectives

<!-- ## Data reception and cleaning -->

# Methods

The data procedures, design and analysis methods used in this report are fully described in the annex document **SAP-2023-017-BH-v01**.

<!-- ## Study parameters -->

<!-- ### Study design -->

<!-- ### Inclusion and exclusion criteria -->

<!-- ### Exposures -->

<!-- ### Outcomes -->

<!-- ### Covariates -->

<!-- ## Statistical analyses -->

This analysis was performed using statistical software `R` version `r getRversion()`.

# Results

## Missing values in the original dataset

Table 1 shows how the number of outcome events increase when missing zip codes are imputed under the various imputation approaches employed.
In all datasets the ID pool remains unchanged, meaning no participant that was dropped was recovered after the imputation approaches evaluated.
Only a small number of new outcome events are gained when the multiple observations per individuals are considered.
The distribution of frequencies of the SES categories vary slightly between approaches, but these proportions appear to be robust to changes in the underlying zip code imputations.

```{r tab_desc}
tab_desc %>%
  as_kable(              # only for markdown
  # as_flex_table(       # only for DOCX
  # ) %>%
  # flextable::set_caption(
    caption = "**Table 1** caption"
  )
```

```{r fig1, fig.cap="**Figure 1** caption"}
# ![Age](../figures/outcome.png)
# knitr::include_graphics("../figures/outcome.png", error = FALSE)
```

After dropping incomplete cases (data available to the model)

- few individuals lost after complete-cases deletion
<!-- ("lost" data frame) -->
- Single: all Single datasets are equal
- multiple:: most deaths are dropped in multiple CC (ZIP not recorded -> no SES)
- multiple: LOCF is equal to LOCF+NOCB
- single death added

```{r}
deaths %>%
  kable(
  # gt(
    caption = "**Table 2** Number of death events available to models in each dataset"
  )
```

## Inferential analysis

- FIMCOG4 is included in single CC (table 4)
- FIMMOTD4 and FIMCOG4 are included in multiple LOCF
- Days to rehab is included in multiple LOCF
- multiple: time-varying exposure is associated with the outcome up to model 5 (clinical+FIM scores)

```{r tab_inf}
tab_inf %>%
  as_kable(              # only for markdown
  # as_flex_table(       # only for DOCX
  # ) %>%
  # flextable::set_caption(
    caption = "**Table 3** caption"
  )
```

```{r}
sch.df %>%
  kable(
  # gt(
    caption = "**Table 4** caption"
  )
```


# Observations and Limitations

# Conclusions

# References

- **SAP-2023-017-BH-v02** -- Analytical Plan for Sensitivity of mortality rates to the imputation of missing socioeconomic data: cohort study

# Appendix

## Exploratory data analysis

N/A

```{r A1, fig.cap="**Figure A1** Distribution of age in the study population."}
# ![Age](../figures/distr_age.png)
# knitr::include_graphics("../figures/distr_age.png", error = FALSE)
```

## Availability

All documents from this consultation were included in the consultant's Portfolio.

<!-- The client has requested that this analysis be kept confidential until a future date, determined by the client. -->
<!-- All documents from this consultation are therefore not published online and only the title and year of the analysis will be included in the consultant's Portfolio. -->
<!-- After the agreed date is reached, the documents will be released. -->

<!-- The client has requested that this analysis be kept confidential. -->
<!-- All documents from this consultation are therefore not published online and only the title and year of the analysis will be included in the consultant's Portfolio. -->

The portfolio is available at:

<https://philsf-biostat.github.io/SAR-2023-017-BH/>

## Associated analyses

This analysis is part of a larger project and is supported by other analyses, linked below.

**Effect of socioeconomic status in mortality rates after brain injury: cohort study**

<https://philsf-biostat.github.io/SAR-2023-004-BH/>

**Time-adjusted effect of socioeconomic status in mortality rates after brain injury: cohort study**

<https://philsf-biostat.github.io/SAR-2023-016-BH/>

## Analytical dataset

Table A1 shows the structure of the analytical dataset.

```{r data}
analytical_mockup %>%
  pander(caption = "**Table A1** Analytical dataset structure", split.table = Inf)
```

Due to confidentiality the data-set used in this analysis cannot be shared online in the public version of this report.
